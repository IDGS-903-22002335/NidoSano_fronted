<div class="p-6 max-w-7xl mx-auto">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold text-gray-800">Componentes Disponibles</h1>
    <div class="flex gap-2">
      <button 
        mat-raised-button
        (click)="toggleRegisterForm()"
        class="inline-flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg shadow-md transition-all duration-200"
        style="background-color: #2fd26a;"
      >
        <span class="material-icons text-white text-lg">add</span>
        <span class="leading-none text-white">Nuevo Componente</span>
      </button>
      
      <!-- Botón Registrar Pérdida -->
      <button 
        (click)="openLossModal()"
        class="flex items-center gap-2 bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg shadow-md transition-all duration-200"
      >
        <span class="material-icons text-white text-lg">remove</span>
        <span class="leading-none">Registrar Pérdida</span>
      </button>
    </div>
  </div>

  <!-- Campo de búsqueda -->
  <div class="mb-6 bg-white p-4 rounded-lg shadow-sm">
    <div class="relative max-w-md">
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <span class="material-icons text-gray-400">search</span>
      </div>
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="filterComponents()"
        placeholder="Buscar componentes..."
        class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      />
    </div>
  </div>

  <div [class.blur-sm]="showRegisterForm || showLossModal" [class.opacity-90]="showRegisterForm || showLossModal">

<div class="bg-white shadow-md rounded-lg overflow-hidden">
  <div class="overflow-x-auto">
    @if (filteredComponents.length > 0) {
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Componente</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoría</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cantidad</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for (comp of filteredComponents; track comp.idComponent) {
          <tr class="transition-colors duration-150 hover:bg-opacity-80"
              [class.bg-red-100]="comp.availableQuantity < 20"
              [class.bg-yellow-100]="comp.availableQuantity >= 20 && comp.availableQuantity < 60"
              [class.bg-green-100]="comp.availableQuantity >= 60">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10 rounded-full flex items-center justify-center"
                     [class.bg-red-200]="comp.availableQuantity < 20"
                     [class.bg-yellow-200]="comp.availableQuantity >= 20 && comp.availableQuantity < 60"
                     [class.bg-green-200]="comp.availableQuantity >= 60">
                  <span>{{ comp.name | slice:0:1 }}</span>
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-900">{{ comp.name }}</div>
                  <div class="text-xs text-gray-500">{{ comp.description }}</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-700">{{ comp.category }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium flex items-center gap-2">
                <span class="w-3 h-3 rounded-full inline-block"
                      [class.bg-red-500]="comp.availableQuantity < 20"
                      [class.bg-yellow-500]="comp.availableQuantity >= 20 && comp.availableQuantity < 60"
                      [class.bg-green-500]="comp.availableQuantity >= 60"></span>
                {{ comp.availableQuantity }}
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    }
    @else {
      <!-- Mensaje cuando no hay resultados -->
      <div class="text-center bg-white p-8 rounded-lg">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="mt-2 text-lg font-medium text-gray-900">
          @if (searchTerm) {
            No se encontraron resultados para "{{searchTerm}}"
          } @else {
            No hay componentes disponibles
          }
        </h3>
        <p class="mt-1 text-sm text-gray-500">
          @if (searchTerm) {
            Intenta con otro término de búsqueda
          } @else {
            No se encontraron componentes registrados
          }
        </p>
      </div>
    }
  </div>
</div>
  </div>
  <!-- Modal de Registrar Pérdida -->
  <div *ngIf="showLossModal" class="fixed inset-0 z-50 flex items-center justify-center">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 border-2 border-red-100 transform transition-all duration-300 ease-out">
      <div class="bg-red-500 px-6 py-4 rounded-t-lg">
        <h2 class="text-xl font-semibold text-white">Registrar Pérdida</h2>
        <button (click)="closeLossModal()" class="absolute top-4 right-4 text-white hover:text-red-100">
          <span class="material-icons">close</span>
        </button>
      </div>

      <!-- Contenido del formulario -->
      <form [formGroup]="lossForm" (ngSubmit)="submitLoss()" class="p-6 space-y-4">
        <!-- Select de lotes -->
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Lote de componente</mat-label>
          <mat-select formControlName="componentLotId" required>
            <mat-option value="" disabled>Selecciona un lote</mat-option>
            <mat-option *ngFor="let lot of componentLots" [value]="lot.componentLotId">
              {{ lot.componentName }} - Disponible: {{ lot.availableQuantity }}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix class="text-red-500">inventory</mat-icon>
        </mat-form-field>

        <!-- Campo Cantidad -->
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Cantidad</mat-label>
          <input matInput type="number" formControlName="amount" required min="1">
          <mat-icon matSuffix class="text-red-500">exposure_neg_1</mat-icon>
        </mat-form-field>

        <!-- Campo Tipo -->
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Tipo de pérdida</mat-label>
          <mat-select formControlName="type" required>
            <mat-option value="Danio">Daño</mat-option>
            <mat-option value="Defecto">Defecto</mat-option>
            <mat-option value="Perdida">Extravío</mat-option>
          </mat-select>
          <mat-icon matSuffix class="text-red-500">warning</mat-icon>
        </mat-form-field>

        <!-- Botones de acción -->
        <div class="flex justify-end gap-3 pt-4">
          <button
            type="button"
            (click)="closeLossModal()"
            class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors"
          >
            Cancelar
          </button>
          <button
            type="submit"
            [disabled]="lossForm.invalid"
            class="px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600 transition-colors disabled:opacity-50 flex items-center gap-1"
          >
            <span class="material-icons">save</span>
            Registrar Pérdida
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Registrar Componente -->
  <div class="fixed inset-0 flex items-center justify-center z-50" [class.hidden]="!showRegisterForm">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 border-2 border-green-100 transform transition-all duration-300 ease-out" 
         [class.opacity-0]="!showRegisterForm"
         [class.scale-95]="!showRegisterForm"
         [class.opacity-100]="showRegisterForm"
         [class.scale-100]="showRegisterForm">
      
      <!-- Encabezado del modal verde -->
      <div class="bg-green-600 px-6 py-4 rounded-t-lg">
        <h2 class="text-xl font-semibold text-white">Registrar Componente</h2>
      </div>

      <!-- Contenido del formulario -->
      <form [formGroup]="componentForm" (ngSubmit)="onSubmit()" class="p-6 space-y-4">
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="name" required>
          <mat-icon matSuffix class="text-green-600">badge</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Descripción</mat-label>
          <input matInput formControlName="description">
          <mat-icon matSuffix class="text-green-600">description</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-full">
          <mat-label>Categoría</mat-label>
          <input matInput formControlName="category" required>
          <mat-icon matSuffix class="text-green-600">category</mat-icon>
        </mat-form-field>

        <div class="flex justify-end gap-3 pt-4">
          <button
            type="button"
            (click)="toggleRegisterForm()"
            class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors"
          >
            Cancelar
          </button>

          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="componentForm.invalid"
            class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-colors disabled:opacity-50"
          >
            Registrar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>